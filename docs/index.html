<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards: Einb√ºrgerungstest</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        :root {
            --background-color: #f4f7f6;
            --card-background: #ffffff;
            --primary-text: #333;
            --secondary-text: #555;
            --accent-color: #007bff;
            --hover-color: #0056b3;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --skip-color: #ffc107;
            --border-color: #ddd;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--primary-text);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .screen {
            padding: 20px 30px 30px 30px;
        }

        .hidden {
            display: none;
        }

        h1, h2 {
            text-align: center;
            color: var(--secondary-text);
            margin-top: 0;
        }

        /* --- Menu Screen --- */
        #menu-screen {
            text-align: center;
        }
        
        #loading-msg {
            font-style: italic;
            color: var(--secondary-text);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            border: 2px solid var(--border-color);
            border-radius: 8px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            color: #fff;
            background-color: var(--accent-color);
            transition: background-color 0.2s ease;
            margin-top: 10px;
            box-sizing: border-box;
        }

        .btn:not(:disabled):hover {
            background-color: var(--hover-color);
        }
        
        .btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-danger {
            background-color: var(--incorrect-color);
            margin-top: 20px;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        /* --- Game Screen --- */
        .scoreboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 15px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .stat {
            text-align: center;
        }
        .stat-title {
            font-size: 0.8em;
            color: var(--secondary-text);
            font-weight: 700;
            text-transform: uppercase;
        }
        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
        }
        #correct-count { color: var(--correct-color); }
        #incorrect-count { color: var(--incorrect-color); }
        #skip-count { color: var(--skip-color); }
        #total-time { color: var(--primary-text); }
        #avg-time { color: var(--primary-text); }

        .flashcard {
            text-align: center;
            padding: 20px 0;
        }

        #german-word {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 20px;
            min-height: 50px;
        }

        #options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .option-btn {
            display: block;
            width: 100%;
            background-color: #f9f9f9;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            font-size: 1em;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-btn:not(:disabled):hover {
            border-color: var(--accent-color);
            background-color: #e6f2ff;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }
        .option-btn.correct {
            background-color: #eaf7ec;
            border-color: var(--correct-color);
            font-weight: 700;
            color: var(--correct-color);
        }
        .option-btn.incorrect {
            background-color: #fdeeee;
            border-color: var(--incorrect-color);
            font-weight: 700;
            color: var(--incorrect-color);
        }

        .game-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        #skip-btn {
            background-color: var(--skip-color);
        }
        #skip-btn:hover {
            background-color: #e0a800;
        }

        /* --- History Screen --- */
        #history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        .history-entry {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .history-entry:last-child {
            border-bottom: none;
        }
        .history-entry-date {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .history-entry-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            font-size: 0.9em;
        }
        .history-entry-stats span {
            display: block;
        }

    </style>
</head>
<body>

    <div class="container">

        <div id="menu-screen" class="screen">
            <h1>Flashcards</h1>
            
            <div id="loading-msg">Loading word list...</div>

            <div class="form-group">
                <label for="lang-select">Answer Language:</label>
                <select id="lang-select">
                    <option value="pt">Portugu√™s (pt-br)</option>
                    <option value="en">English (en-us)</option>
                </select>
            </div>

            <button id="new-game-btn" class="btn">New Game</button>
            <button id="history-btn" class="btn btn-secondary">History</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <h2>Einb√ºrgerungstest</h2>
            
            <div class="scoreboard">
                <div class="stat"><span class="stat-title">Correct</span><span id="correct-count" class="stat-value">0</span></div>
                <div class="stat"><span class="stat-title">Incorrect</span><span id="incorrect-count" class="stat-value">0</span></div>
                <div class="stat"><span class="stat-title">Skipped</span><span id="skip-count" class="stat-value">0</span></div>
                <div class="stat"><span class="stat-title">Total Time</span><span id="total-time" class="stat-value">00:00</span></div>
                <div class="stat" style="grid-column: 1 / -1;"><span class="stat-title">Avg. Time / Q</span><span id="avg-time" class="stat-value">0.0s</span></div>
            </div>

            <div class="flashcard">
                <div id="german-word">Loading...</div>
            </div>

            <div id="options-container"></div>

            <div class="game-controls">
                <button id="skip-btn" class="btn">Skip</button>
                <button id="end-game-btn" class="btn btn-secondary">End Game</button>
            </div>
        </div>

        <div id="history-screen" class="screen hidden">
            <h2>Game History</h2>
            
            <div id="history-list">
                <p>No games in history.</p>
            </div>

            <button id="clear-history-btn" class="btn btn-danger">Clear History</button>
            <button id="back-to-menu-btn" class="btn btn-secondary">Back to Menu</button>
        </div>

    </div>

    <script>
        // --- 1. Dados do Jogo (Resolvido o CORS) ---
        const WORD_LIST = [
            // category: "politik" (Pol√≠tica e Governo - Source 2)
            { "de": "der Staat", "pt": "o Estado", "en": "the State", "category": "politik" },
            { "de": "die Bundesregierung", "pt": "o governo federal", "en": "the federal government", "category": "politik" },
            { "de": "der Bundestag", "pt": "o Parlamento Federal da Alemanha", "en": "the Federal Parliament of Germany", "category": "politik" },
            { "de": "der Bundesrat", "pt": "o Conselho Federal (representa os Estados)", "en": "the Federal Council (represents the states)", "category": "politik" },
            { "de": "die Bundesrepublik", "pt": "a Rep√∫blica Federal", "en": "the Federal Republic", "category": "politik" },
            { "de": "das Bundesland", "pt": "o estado federado (ex: Bayern, Brandenburg)", "en": "the federal state (e.g., Bavaria, Brandenburg)", "category": "politik" },
            { "de": "der Bundeskanzler / die Bundeskanzlerin", "pt": "o(a) chanceler federal", "en": "the Federal Chancellor", "category": "politik" },
            { "de": "der Bundespr√§sident / die Bundespr√§sidentin", "pt": "o(a) presidente federal", "en": "the Federal President", "category": "politik" },
            { "de": "die Wahl", "pt": "a elei√ß√£o", "en": "the election", "category": "politik" },
            { "de": "die Stimme", "pt": "o voto", "en": "the vote", "category": "politik" },
            { "de": "w√§hlen", "pt": "votar / escolher", "en": "to vote / to choose", "category": "politik" },
            { "de": "das Wahlrecht", "pt": "o direito de votar", "en": "the right to vote", "category": "politik" },
            { "de": "das Grundgesetz", "pt": "a Lei Fundamental (Constitui√ß√£o alem√£)", "en": "the Basic Law (German Constitution)", "category": "politik" },
            { "de": "die Demokratie", "pt": "a democracia", "en": "the democracy", "category": "politik" },
            { "de": "die Diktatur", "pt": "a ditadura", "en": "the dictatorship", "category": "politik" },
            { "de": "das Ministerium", "pt": "o minist√©rio", "en": "the ministry", "category": "politik" },
            { "de": "der Minister / die Ministerin", "pt": "o(a) ministro(a)", "en": "the minister", "category": "politik" },
            { "de": "der Ministerpr√§sident / die Ministerpr√§sidentin", "pt": "chefe de governo de um estado federado", "en": "head of government of a federal state", "category": "politik" },
            { "de": "die Exekutive", "pt": "o poder executivo", "en": "the executive branch", "category": "politik" },
            { "de": "die Legislative", "pt": "o poder legislativo", "en": "the legislative branch", "category": "politik" },
            { "de": "die Judikative", "pt": "o poder judici√°rio", "en": "the judicial branch", "category": "politik" },

            // category: "recht" (Direitos, Leis e Justi√ßa - Source 4)
            { "de": "das Recht", "pt": "o direito", "en": "the right / the law", "category": "recht" },
            { "de": "das Grundrecht", "pt": "o direito fundamental", "en": "the fundamental right", "category": "recht" },
            { "de": "die Meinungsfreiheit", "pt": "a liberdade de opini√£o", "en": "the freedom of opinion", "category": "recht" },
            { "de": "die Religionsfreiheit", "pt": "a liberdade religiosa", "en": "the freedom of religion", "category": "recht" },
            { "de": "die Pressefreiheit", "pt": "a liberdade de imprensa", "en": "the freedom of the press", "category": "recht" },
            { "de": "die Versammlungsfreiheit", "pt": "a liberdade de reuni√£o", "en": "the freedom of assembly", "category": "recht" },
            { "de": "die Gleichbehandlung", "pt": "a igualdade de tratamento", "en": "the equal treatment", "category": "recht" },
            { "de": "verboten", "pt": "proibido", "en": "forbidden / prohibited", "category": "recht" },
            { "de": "erlaubt", "pt": "permitido", "en": "allowed / permitted", "category": "recht" },
            { "de": "die Gewalt (im Staat)", "pt": "o poder (no Estado)", "en": "the power (in the State)", "category": "recht" },
            { "de": "die Strafbarkeit", "pt": "a punibilidade", "en": "the culpability", "category": "recht" },
            { "de": "die Straftat", "pt": "o ato criminoso", "en": "the criminal act", "category": "recht" },
            { "de": "das Gericht", "pt": "o tribunal", "en": "the court", "category": "recht" },
            { "de": "der Richter / die Richterin", "pt": "o(a) juiz(a)", "en": "the judge", "category": "recht" },
            { "de": "der Rechtsanwalt / die Rechtsanw√§ltin", "pt": "o(a) advogado(a)", "en": "the lawyer", "category": "recht" },
            { "de": "das Urteil", "pt": "a senten√ßa / o veredito", "en": "the verdict / judgment", "category": "recht" },
            { "de": "der Prozess", "pt": "o processo (judicial)", "en": "the trial (judicial process)", "category": "recht" },
            { "de": "die Klage", "pt": "a a√ß√£o judicial / queixa", "en": "the lawsuit / complaint", "category": "recht" },
            { "de": "Einspruch einlegen", "pt": "apresentar recurso / obje√ß√£o", "en": "to file an objection", "category": "recht" },
            { "de": "der Arbeitsvertrag", "pt": "o contrato de trabalho", "en": "the employment contract", "category": "recht" },
            { "de": "die K√ºndigung", "pt": "a demiss√£o (ou rescis√£o do contrato)", "en": "the termination (of contract)", "category": "recht" },
            { "de": "das Arbeitsgericht", "pt": "o tribunal trabalhista", "en": "the labor court", "category": "recht" },

            // category: "geschichte" (Hist√≥ria e Sociedade - Source 6)
            { "de": "der Zweite Weltkrieg (1939‚Äì1945)", "pt": "a Segunda Guerra Mundial", "en": "the Second World War", "category": "geschichte" },
            { "de": "die Wiedervereinigung (1990)", "pt": "a reunifica√ß√£o (da Alemanha)", "en": "the reunification (of Germany)", "category": "geschichte" },
            { "de": "die DDR (Deutsche Demokratische Republik)", "pt": "a Alemanha Oriental (RDA em portugu√™s)", "en": "East Germany (GDR)", "category": "geschichte" },
            { "de": "die BRD (Bundesrepublik Deutschland)", "pt": "a Alemanha Ocidental", "en": "West Germany (FRG)", "category": "geschichte" },
            { "de": "die Besatzungsmacht", "pt": "a pot√™ncia ocupante", "en": "the occupying power", "category": "geschichte" },
            { "de": "die Wende (1989)", "pt": "a virada (queda do Muro de Berlim etc.)", "en": "the turning point (fall of the Wall, etc.)", "category": "geschichte" },
            { "de": "der Holocaust", "pt": "o Holocausto", "en": "the Holocaust", "category": "geschichte" },
            { "de": "die Nationalsozialisten / die Nazis", "pt": "os nacional-socialistas (nazistas)", "en": "the National Socialists (Nazis)", "category": "geschichte" },
            { "de": "die NS-Zeit (1933‚Äì1945)", "pt": "o per√≠odo nazista", "en": "the Nazi period", "category": "geschichte" },
            { "de": "die Siegerm√§chte / Alliierten", "pt": "as pot√™ncias aliadas", "en": "the Allied powers", "category": "geschichte" },
            { "de": "der Warschauer Pakt", "pt": "o Pacto de Vars√≥via", "en": "the Warsaw Pact", "category": "geschichte" },
            { "de": "die NATO", "pt": "a OTAN (alian√ßa militar ocidental)", "en": "NATO (Western military alliance)", "category": "geschichte" },
            { "de": "die Bundeswehr", "pt": "as For√ßas Armadas Alem√£s", "en": "the German Armed Forces", "category": "geschichte" },

            // category: "kultur" (Sociedade, Cultura e Datas Festivas - Source 8)
            { "de": "das Fest", "pt": "a festa", "en": "the party / festival", "category": "kultur" },
            { "de": "Weihnachten", "pt": "Natal", "en": "Christmas", "category": "kultur" },
            { "de": "Ostern", "pt": "P√°scoa", "en": "Easter", "category": "kultur" },
            { "de": "Pfingsten", "pt": "Pentecostes", "en": "Pentecost (Whitsun)", "category": "kultur" },
            { "de": "der Rosenmontag", "pt": "a segunda-feira de carnaval", "en": "Carnival Monday", "category": "kultur" },
            { "de": "der Feiertag", "pt": "o feriado", "en": "the holiday", "category": "kultur" },
            { "de": "der Brauch", "pt": "o costume / a tradi√ß√£o", "en": "the custom / tradition", "category": "kultur" },
            { "de": "die Maske", "pt": "a m√°scara", "en": "the mask", "category": "kultur" },
            { "de": "das Kost√ºm", "pt": "a fantasia / o traje de carnaval", "en": "the costume", "category": "kultur" },
            { "de": "der Tannenbaum", "pt": "a √°rvore de Natal", "en": "the Christmas tree", "category": "kultur" },
            { "de": "die Eier bemalen", "pt": "pintar ovos (tradi√ß√£o de P√°scoa)", "en": "to paint eggs (Easter tradition)", "category": "kultur" },
            { "de": "die Einheit", "pt": "a unidade (Tag der Deutschen Einheit ‚Äì 3/10)", "en": "the unity (Day of German Unity - 3/10)", "category": "kultur" },
            { "de": "der Gedenktag", "pt": "o dia de mem√≥ria / de comemora√ß√£o", "en": "the day of remembrance", "category": "kultur" },

            // category: "soziales" (Estrutura Familiar, Educa√ß√£o e Benef√≠cios Sociais - Source 10)
            { "de": "die Familie", "pt": "a fam√≠lia", "en": "the family", "category": "soziales" },
            { "de": "das Jugendamt", "pt": "o servi√ßo de prote√ß√£o √† crian√ßa e ao adolescente", "en": "the Youth Welfare Office", "category": "soziales" },
            { "de": "der Kindergarten", "pt": "o jardim de inf√¢ncia", "en": "the kindergarten", "category": "soziales" },
            { "de": "die Schule", "pt": "a escola", "en": "the school", "category": "soziales" },
            { "de": "die Schulpflicht", "pt": "a obriga√ß√£o / compulsoriedade escolar", "en": "the compulsory schooling", "category": "soziales" },
            { "de": "die Ausbildung", "pt": "a forma√ß√£o profissional (geral)", "en": "the vocational training", "category": "soziales" },
            { "de": "das Studium", "pt": "o estudo universit√°rio", "en": "the university study", "category": "soziales" },
            { "de": "das Abitur", "pt": "o exame final do Ensino M√©dio (habilita √† faculdade)", "en": "the high school graduation exam (qualifies for university)", "category": "soziales" },
            { "de": "die Krankenversicherung", "pt": "o seguro de sa√∫de", "en": "the health insurance", "category": "soziales" },
            { "de": "die Pflegeversicherung", "pt": "o seguro de cuidados (p/ idosos, dependentes etc.)", "en": "the long-term care insurance", "category": "soziales" },
            { "de": "die Rentenversicherung", "pt": "o seguro de aposentadoria", "en": "the pension insurance", "category": "soziales" },
            { "de": "das Elterngeld", "pt": "o benef√≠cio parental", "en": "the parental allowance", "category": "soziales" },
            { "de": "der Mutterschutz", "pt": "a prote√ß√£o √† maternidade", "en": "the maternity protection", "category": "soziales" },

            // category: "wirtschaft" (Economia, Finan√ßas e Trabalho - Source 12)
            { "de": "die soziale Marktwirtschaft", "pt": "a economia social de mercado", "en": "the social market economy", "category": "wirtschaft" },
            { "de": "der Lohn / das Gehalt", "pt": "o sal√°rio / ordenado", "en": "the wage / salary", "category": "wirtschaft" },
            { "de": "die Steuer", "pt": "o imposto", "en": "the tax", "category": "wirtschaft" },
            { "de": "die Kirchensteuer", "pt": "o imposto religioso (igreja)", "en": "the church tax", "category": "wirtschaft" },
            { "de": "die Sozialversicherung", "pt": "o seguro social", "en": "the social security", "category": "wirtschaft" },
            { "de": "die Arbeitslosenversicherung", "pt": "o seguro-desemprego", "en": "the unemployment insurance", "category": "wirtschaft" },
            { "de": "die Agentur f√ºr Arbeit", "pt": "a ag√™ncia de emprego", "en": "the employment agency", "category": "wirtschaft" },
            { "de": "das Arbeitsamt (antigo nome)", "pt": "ag√™ncia de emprego (antes: ‚ÄòArbeitsamt‚Äô)", "en": "employment office (old name)", "category": "wirtschaft" },
            { "de": "die Schwarzarbeit", "pt": "o trabalho ilegal / n√£o declarado", "en": "the undeclared work", "category": "wirtschaft" },

            // category: "diverses" (Diversos Termos Recorrentes - Source 14)
            { "de": "die Beh√∂rde", "pt": "a reparti√ß√£o p√∫blica / o √≥rg√£o p√∫blico", "en": "the authority / public office", "category": "diverses" },
            { "de": "das Einwohnermeldeamt", "pt": "o setor de registro de residentes (cart√≥rio de endere√ßo)", "en": "the residents' registration office", "category": "diverses" },
            { "de": "das Standesamt", "pt": "o cart√≥rio de registro civil", "en": "the registry office", "category": "diverses" },
            { "de": "das Gewerbeamt", "pt": "o departamento/licen√ßa de atividades comerciais", "en": "the trade office", "category": "diverses" },
            { "de": "die B√ºrgerinitiative", "pt": "a iniciativa popular", "en": "the citizens' initiative", "category": "diverses" },
            { "de": "die Meinungs√§u√üerung", "pt": "a manifesta√ß√£o de opini√£o", "en": "the expression of opinion", "category": "diverses" },
            { "de": "die Demonstration anmelden", "pt": "registrar a manifesta√ß√£o", "en": "to register the demonstration", "category": "diverses" },
            { "de": "die Polizeiwache / das Polizeirevier", "pt": "a delegacia de pol√≠cia", "en": "the police station", "category": "diverses" },
            { "de": "der Reisepass", "pt": "o passaporte", "en": "the passport", "category": "diverses" },
            { "de": "der Personalausweis", "pt": "a carteira de identidade", "en": "the ID card", "category": "diverses" },
            { "de": "die Staatsangeh√∂rigkeit", "pt": "a nacionalidade", "en": "the nationality", "category": "diverses" },
            { "de": "die Einb√ºrgerung", "pt": "a naturaliza√ß√£o", "en": "the naturalization", "category": "diverses" },
            { "de": "die Unterlagen (pl.)", "pt": "a documenta√ß√£o", "en": "the documents", "category": "diverses" },
            { "de": "das Formular", "pt": "o formul√°rio", "en": "the form", "category": "diverses" },
            { "de": "die Anmeldung", "pt": "o registro, a inscri√ß√£o", "en": "the registration", "category": "diverses" },
            { "de": "das Wohnrecht", "pt": "o direito de moradia", "en": "the right of residence", "category": "diverses" },
            { "de": "die Hausordnung", "pt": "o regulamento do pr√©dio (condom√≠nio)", "en": "the house rules", "category": "diverses" },

            // category: "geographie" (Estados e Capitais - Source 15)
            { "de": "Baden-W√ºrttemberg", "pt": "Stuttgart", "en": "Stuttgart", "category": "geographie" },
            { "de": "Bayern (Baviera)", "pt": "M√ºnchen (Munique)", "en": "Munich", "category": "geographie" },
            { "de": "Berlin", "pt": "Berlin", "en": "Berlin", "category": "geographie" },
            { "de": "Brandenburg", "pt": "Potsdam", "en": "Potsdam", "category": "geographie" },
            { "de": "Bremen", "pt": "Bremen", "en": "Bremen", "category": "geographie" },
            { "de": "Hamburg", "pt": "Hamburg", "en": "Hamburg", "category": "geographie" },
            { "de": "Hessen", "pt": "Wiesbaden", "en": "Wiesbaden", "category": "geographie" },
            { "de": "Mecklenburg-Vorpommern", "pt": "Schwerin", "en": "Schwerin", "category": "geographie" },
            { "de": "Niedersachsen (Baixa Sax√¥nia)", "pt": "Hannover", "en": "Hanover", "category": "geographie" },
            { "de": "Nordrhein-Westfalen", "pt": "D√ºsseldorf", "en": "D√ºsseldorf", "category": "geographie" },
            { "de": "Rheinland-Pfalz", "pt": "Mainz", "en": "Mainz", "category": "geographie" },
            { "de": "Saarland", "pt": "Saarbr√ºcken", "en": "Saarbr√ºcken", "category": "geographie" },
            { "de": "Sachsen (Sax√¥nia)", "pt": "Dresden", "en": "Dresden", "category": "geographie" },
            { "de": "Sachsen-Anhalt", "pt": "Magdeburg", "en": "Magdeburg", "category": "geographie" },
            { "de": "Schleswig-Holstein", "pt": "Kiel", "en": "Kiel", "category": "geographie" },
            { "de": "Th√ºringen", "pt": "Erfurt", "en": "Erfurt", "category": "geographie" }
        ];

        // --- 2. Vari√°veis Globais ---
        let wordList = []; // Ser√° preenchida por WORD_LIST
        let gameHistory = [];
        let currentGame = {};
        let currentCorrectAnswer = null;
        let totalTimeInterval = null;
        let questionStartTime = null;

        const HISTORY_KEY = "flashcardHistory";
        const TOTAL_OPTIONS = 5;
        const SIMILAR_OPTIONS_COUNT = 2;

        // --- 3. Elementos do DOM ---
        const screens = {
            menu: document.getElementById('menu-screen'),
            game: document.getElementById('game-screen'),
            history: document.getElementById('history-screen')
        };
        const buttons = {
            newGame: document.getElementById('new-game-btn'),
            history: document.getElementById('history-btn'),
            backToMenu: document.getElementById('back-to-menu-btn'),
            clearHistory: document.getElementById('clear-history-btn'),
            skip: document.getElementById('skip-btn'),
            endGame: document.getElementById('end-game-btn')
        };
        const ui = {
            loadingMsg: document.getElementById('loading-msg'),
            langSelect: document.getElementById('lang-select'),
            germanWord: document.getElementById('german-word'),
            optionsContainer: document.getElementById('options-container'),
            historyList: document.getElementById('history-list'),
            // Placar
            correctCount: document.getElementById('correct-count'),
            incorrectCount: document.getElementById('incorrect-count'),
            skipCount: document.getElementById('skip-count'),
            totalTime: document.getElementById('total-time'),
            avgTime: document.getElementById('avg-time')
        };

        // --- 4. Navega√ß√£o entre Telas ---
        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            screens[screenId].classList.remove('hidden');
        }

        // --- 5. Fun√ß√µes de Formata√ß√£o e Utilit√°rios ---
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const min = String(Math.floor(seconds / 60)).padStart(2, '0');
            const sec = String(seconds % 60).padStart(2, '0');
            return `${min}:${sec}`;
        }
        
        function formatAvgTime(ms) {
            if (ms === 0) return '0.0s';
            return (ms / 1000).toFixed(1) + 's';
        }
        
        // Fun√ß√£o para embaralhar um array (Fisher-Yates shuffle)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- 6. L√≥gica de Hist√≥rico (LocalStorage) ---
        function loadHistory() {
            gameHistory = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
        }

        function saveHistory() {
            localStorage.setItem(HISTORY_KEY, JSON.stringify(gameHistory));
        }
        
        function renderHistory() {
            ui.historyList.innerHTML = '';
            if (gameHistory.length === 0) {
                ui.historyList.innerHTML = '<p style="text-align: center;">No games in history.</p>';
                return;
            }
            
            gameHistory.slice().reverse().forEach(game => {
                const date = new Date(game.date).toLocaleString('en-US');
                const lang = game.lang === 'pt' ? 'Portuguese' : 'English';
                const totalTime = formatTime(game.totalTime);
                const avgTime = formatAvgTime(game.avgTime);
                
                const entry = document.createElement('div');
                entry.className = 'history-entry';
                entry.innerHTML = `
                    <div class="history-entry-date">${date} (Language: ${lang})</div>
                    <div class="history-entry-stats">
                        <span>‚úÖ Correct: ${game.correct}</span>
                        <span>‚ùå Incorrect: ${game.incorrect}</span>
                        <span>‚Ü∑ Skipped: ${game.skipped}</span>
                        <span>‚è±Ô∏è Total Time: ${totalTime}</span>
                        <span style="grid-column: 1 / -1;">üìä Avg. Time: ${avgTime} / question</span>
                    </div>
                `;
                ui.historyList.appendChild(entry);
            });
        }
        
        function showHistoryScreen() {
            renderHistory();
            showScreen('history');
        }
        
        function clearHistory() {
            if (confirm('Are you sure you want to clear all history?')) {
                gameHistory = [];
                saveHistory();
                renderHistory();
            }
        }

        // --- 7. L√≥gica do Jogo ---
        function initializeData() {
            wordList = WORD_LIST;
            if (wordList.length > 0) {
                ui.loadingMsg.textContent = 'Word list loaded!';
                ui.loadingMsg.style.color = 'var(--correct-color)';
                buttons.newGame.disabled = false;
            } else {
                ui.loadingMsg.textContent = 'Error: Word list is empty.';
                ui.loadingMsg.style.color = 'var(--incorrect-color)';
            }
        }
        
        function updateTimers() {
            const elapsedMs = Date.now() - currentGame.startTime;
            ui.totalTime.textContent = formatTime(elapsedMs);
        }
        
        function updateAverageTime() {
            if (currentGame.questionTimes.length === 0) {
                ui.avgTime.textContent = '0.0s';
                return;
            }
            const total = currentGame.questionTimes.reduce((a, b) => a + b, 0);
            const avg = total / currentGame.questionTimes.length;
            ui.avgTime.textContent = formatAvgTime(avg);
        }

        function startGame() {
            const selectedLang = ui.langSelect.value;
            
            currentGame = {
                lang: selectedLang,
                correct: 0,
                incorrect: 0,
                skipped: 0,
                startTime: Date.now(),
                questionTimes: [],
                date: new Date().toISOString()
            };
            
            ui.correctCount.textContent = '0';
            ui.incorrectCount.textContent = '0';
            ui.skipCount.textContent = '0';
            
            totalTimeInterval = setInterval(updateTimers, 1000);
            updateTimers();
            updateAverageTime();
            
            loadNewQuestion();
            showScreen('game');
        }
        
        function endGame() {
            clearInterval(totalTimeInterval);
            
            currentGame.totalTime = Date.now() - currentGame.startTime;
            const totalQuestionTime = currentGame.questionTimes.reduce((a, b) => a + b, 0);
            currentGame.avgTime = (currentGame.questionTimes.length > 0) 
                                ? totalQuestionTime / currentGame.questionTimes.length 
                                : 0;
            
            gameHistory.push(currentGame);
            saveHistory();
            
            currentGame = {};
            showScreen('menu');
        }

        function loadNewQuestion() {
            ui.optionsContainer.innerHTML = '';
            
            // 1. Escolhe a palavra correta
            const correctEntry = wordList[Math.floor(Math.random() * wordList.length)];
            const lang = currentGame.lang;
            currentCorrectAnswer = correctEntry[lang];
            
            let optionsSet = new Set();
            optionsSet.add(currentCorrectAnswer);

            // 2. Encontra op√ß√µes "similares" (mesma categoria)
            let similarCandidates = wordList.filter(entry => 
                entry.category === correctEntry.category && entry[lang] !== currentCorrectAnswer
            );
            shuffle(similarCandidates);
            
            for (let i = 0; i < SIMILAR_OPTIONS_COUNT && i < similarCandidates.length; i++) {
                optionsSet.add(similarCandidates[i][lang]);
            }
            
            // 3. Encontra op√ß√µes "aleat√≥rias" (para completar 5)
            let randomCandidates = wordList.filter(entry => entry[lang] !== currentCorrectAnswer);
            shuffle(randomCandidates);

            let candidateIndex = 0;
            while (optionsSet.size < TOTAL_OPTIONS && candidateIndex < randomCandidates.length) {
                optionsSet.add(randomCandidates[candidateIndex][lang]);
                candidateIndex++;
            }
            
            // 4. Renderiza
            ui.germanWord.textContent = correctEntry.de;
            
            let finalOptions = shuffle(Array.from(optionsSet));
            finalOptions.forEach(optionText => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = optionText;
                button.onclick = () => checkAnswer(optionText, button);
                ui.optionsContainer.appendChild(button);
            });
            
            questionStartTime = Date.now();
        }

        function recordQuestionTime() {
            const duration = Date.now() - questionStartTime;
            currentGame.questionTimes.push(duration);
            updateAverageTime();
        }

        function checkAnswer(selectedText, buttonEl) {
            recordQuestionTime();
            
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
			let delayTime = 350;
            
            if (selectedText === currentCorrectAnswer) {
                currentGame.correct++;
                ui.correctCount.textContent = currentGame.correct;
                buttonEl.classList.add('correct');
            } else {
                currentGame.incorrect++;
                ui.incorrectCount.textContent = currentGame.incorrect;
                buttonEl.classList.add('incorrect');
				delayTime = 1500;
                
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === currentCorrectAnswer) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            setTimeout(loadNewQuestion, delayTime);
        }

        function skipQuestion() {
            recordQuestionTime();
            
            currentGame.skipped++;
            ui.skipCount.textContent = currentGame.skipped;
            
            loadNewQuestion();
        }

        // --- 8. Inicializa√ß√£o ---
        document.addEventListener('DOMContentLoaded', () => {
            buttons.newGame.onclick = startGame;
            buttons.history.onclick = showHistoryScreen;
            buttons.backToMenu.onclick = () => showScreen('menu');
            buttons.clearHistory.onclick = clearHistory;
            buttons.skip.onclick = skipQuestion;
            buttons.endGame.onclick = endGame;
            
            loadHistory();
            initializeData(); // Carrega os dados internos em vez de fetch
            
            showScreen('menu');
        });

    </script>
</body>
</html>